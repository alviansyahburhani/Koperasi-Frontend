{"file":"auth-Di8Nwi7s.js","mappings":"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","names":[],"sources":["../../../../../../../app/services/api.service.ts","../../../../../../../app/services/auth.service.ts","../../../../../../../app/stores/auth.ts"],"sourcesContent":["/**\n * API Service with Complete Error Handling\n */\n\nexport class ApiService {\n  private baseURL: string\n  private timeout: number\n  private debugMode: boolean\n  private initialized: boolean = false\n\n  constructor() {\n    this.baseURL = ''\n    this.timeout = 30000\n    this.debugMode = false\n  }\n\n  /**\n   * Initialize config\n   */\n  private initConfig() {\n    if (!this.initialized) {\n      const config = useRuntimeConfig()\n      this.baseURL = config.public.apiBase as string\n      this.timeout = config.public.apiTimeout as number\n      this.debugMode = config.public.debugMode as boolean\n      this.initialized = true\n\n      if (this.debugMode) {\n        console.log('[ApiService] Initialized:', { baseURL: this.baseURL })\n      }\n    }\n  }\n\n  /**\n   * Get headers with auth token\n   */\n  private getHeaders(): HeadersInit {\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      Accept: 'application/json',\n    }\n\n    // Add auth token if exists\n    if (import.meta.client) {\n      const token = localStorage.getItem('access_token')\n      if (token) {\n        headers['Authorization'] = `Bearer ${token}`\n      }\n    }\n\n    return headers\n  }\n\n  /**\n   * Handle API Error\n   * ✅ FIX: useErrorHandler hunknowna bisa dipanggil di Nuxt context\n   */\n  private handleError(error: unknown): never {\n    // Simple error handling tanpa composable\n    const statusCode = error.statusCode || error.response?.status || 500\n    const message = error.message || error.response?.data?.message || 'Terjadi kesalahan'\n\n    // Log di development\n    if (this.debugMode) {\n      console.error('[ApiService] Error:', {\n        statusCode,\n        message,\n        error,\n      })\n    }\n\n    // Handle 401 - Auto logout\n    if (statusCode === 401 && import.meta.client) {\n      localStorage.removeItem('access_token')\n      localStorage.removeItem('refresh_token')\n      navigateTo('/auth/login')\n    }\n\n    // Throw formatted error\n    throw createError({\n      statusCode,\n      message,\n      data: error.response?.data,\n    })\n  }\n\n  /**\n   * Make HTTP Request\n   */\n  private async request<T>(\n    method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE',\n    endpoint: string,\n    data?: unknown\n  ): Promise<T> {\n    this.initConfig()\n\n    const url = `${this.baseURL}${endpoint}`\n\n    if (this.debugMode) {\n      console.log(`[ApiService] ${method} ${url}`, data)\n    }\n\n    try {\n      const response = await $fetch<T>(url, {\n        method,\n        headers: this.getHeaders(),\n        body: data,\n        timeout: this.timeout,\n        retry: method === 'GET' ? 2 : 0,\n        retryDelay: 1000,\n      })\n\n      if (this.debugMode) {\n        console.log(`[ApiService] Response ${method} ${url}:`, response)\n      }\n\n      return response\n    } catch (error: unknown) {\n      if (this.debugMode) {\n        console.error(`[ApiService] Error ${method} ${url}:`, error)\n      }\n\n      this.handleError(error)\n    }\n  }\n\n  /**\n   * GET request\n   */\n  async get<T>(endpoint: string): Promise<T> {\n    return this.request<T>('GET', endpoint)\n  }\n\n  /**\n   * POST request\n   */\n  async post<T>(endpoint: string, data?: unknown): Promise<T> {\n    return this.request<T>('POST', endpoint, data)\n  }\n\n  /**\n   * PUT request\n   */\n  async put<T>(endpoint: string, data: unknown): Promise<T> {\n    return this.request<T>('PUT', endpoint, data)\n  }\n\n  /**\n   * PATCH request\n   */\n  async patch<T>(endpoint: string, data: unknown): Promise<T> {\n    return this.request<T>('PATCH', endpoint, data)\n  }\n\n  /**\n   * DELETE request\n   */\n  async delete<T>(endpoint: string): Promise<T> {\n    return this.request<T>('DELETE', endpoint)\n  }\n}\n\n// Export singleton instance\nexport const apiService = new ApiService()\n","import { apiService } from './api.service'\n\nexport interface LoginCredentials {\n  email: string\n  password: string\n}\n\nexport interface LoginResponse {\n  accessToken: string\n  refreshToken: string\n  warning?: {\n    code: string\n    message: string\n    subscriptionEndDate?: Date\n    actionRequired: string\n  }\n}\n\nexport interface JwtPayload {\n  sub: string\n  email: string\n  role: string\n  tenantId?: string\n  subscriptionStatus?: string\n  isExpired?: boolean\n  isGracePeriod?: boolean\n  iat?: number\n  exp?: number\n}\n\nexport interface UserProfile {\n  id: string\n  email: string\n  role: string\n  name?: string\n  tenantId?: string\n}\n\nexport class AuthService {\n  /**\n   * ✅ Detect if Super Admin based on URL\n   * Super Admin = localhost tanpa subdomain\n   * Tenant = subdomain.localhost\n   */\n  private isSuperAdminContext(): boolean {\n    if (!import.meta.client) return false\n\n    const hostname = window.location.hostname\n    const parts = hostname.split('.')\n\n    // localhost atau 127.0.0.1 (tanpa subdomain) = Super Admin\n    if (hostname === 'localhost' || hostname === '127.0.0.1') {\n      return true\n    }\n\n    // Jika ada subdomain (parts > 1) dan bukan 'www' = Tenant\n    if (parts.length > 1 && parts[0] !== 'www') {\n      return false\n    }\n\n    // Default: assume super admin\n    return true\n  }\n\n  /**\n   * Login - Auto detect super admin vs tenant based on URL\n   */\n  async login(credentials: LoginCredentials): Promise<LoginResponse> {\n    const config = useRuntimeConfig()\n    const isSuperAdmin = this.isSuperAdminContext()\n\n    if (config.public.debugMode) {\n      console.log('[AuthService] Login context:', {\n        email: credentials.email,\n        hostname: import.meta.client ? window.location.hostname : 'SSR',\n        isSuperAdmin,\n      })\n    }\n\n    // ✅ Use different endpoint based on context\n    const endpoint = isSuperAdmin\n      ? '/api/admin/auth/login' // Super admin login\n      : '/api/auth/login' // Tenant login\n\n    if (config.public.debugMode) {\n      console.log('[AuthService] Using endpoint:', endpoint)\n    }\n\n    return apiService.post<LoginResponse>(endpoint, {\n      email: credentials.email,\n      password: credentials.password,\n    })\n  }\n\n  /**\n   * Get User Profile from Backend\n   */\n  async getProfile(): Promise<UserProfile> {\n    const isSuperAdmin = this.isSuperAdminContext()\n\n    // ✅ Use different endpoint based on context\n    const endpoint = isSuperAdmin\n      ? '/api/admin/auth/profile' // Jika ada\n      : '/api/auth/profile'\n\n    const response = await apiService.get<unknown>(endpoint)\n\n    return {\n      id: response.id || response.sub,\n      email: response.email,\n      role: response.role,\n      name: response.name,\n      tenantId: response.tenantId,\n    }\n  }\n\n  /**\n   * Refresh Token\n   */\n  async refreshToken(): Promise<{ accessToken: string }> {\n    const isSuperAdmin = this.isSuperAdminContext()\n\n    // ✅ Use different endpoint based on context\n    const endpoint = isSuperAdmin ? '/api/admin/auth/refresh' : '/api/auth/refresh'\n\n    return apiService.post<{ accessToken: string }>(endpoint, {})\n  }\n\n  /**\n   * Logout\n   */\n  async logout(): Promise<void> {\n    if (import.meta.client) {\n      localStorage.removeItem('access_token')\n      localStorage.removeItem('refresh_token')\n      localStorage.removeItem('user')\n    }\n  }\n\n  /**\n   * Decode JWT Token\n   */\n  decodeToken(token: string): JwtPayload | null {\n    try {\n      const parts = token.split('.')\n\n      if (parts.length !== 3) {\n        console.error('[AuthService] Invalid token format')\n        return null\n      }\n\n      const base64Url = parts[1]\n\n      if (!base64Url) {\n        console.error('[AuthService] Token payload is missing')\n        return null\n      }\n\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')\n      const jsonPayload = decodeURIComponent(\n        atob(base64)\n          .split('')\n          .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n          .join('')\n      )\n\n      return JSON.parse(jsonPayload) as JwtPayload\n    } catch (error) {\n      console.error('[AuthService] Failed to decode token:', error)\n      return null\n    }\n  }\n\n  /**\n   * Check if token is expired\n   */\n  isTokenExpired(token: string): boolean {\n    const payload = this.decodeToken(token)\n    if (!payload || !payload.exp) return true\n\n    const now = Math.floor(Date.now() / 1000)\n    return payload.exp < now\n  }\n}\n\nexport const authService = new AuthService()\n","import { defineStore } from 'pinia'\nimport { authService, type LoginCredentials, type UserProfile } from '~/services/auth.service'\n\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    user: null as UserProfile | null,\n    token: null as string | null,\n    refreshToken: null as string | null,\n    isAuthenticated: false,\n    loading: false,\n  }),\n\n  getters: {\n    /**\n     * User role (raw dari backend)\n     */\n    userRole: (state) => state.user?.role || null,\n\n    /**\n     * Super Admin check\n     */\n    isSuperadmin: (state) => {\n      const role = state.user?.role?.toUpperCase()\n      return role === 'SUPERADMIN'\n    },\n\n    /**\n     * ✅ Pengurus check (admin koperasi)\n     */\n    isPengurus: (state) => {\n      const role = state.user?.role\n      return role === 'Pengurus' // Case-sensitive sesuai backend\n    },\n\n    /**\n     * ✅ Pengawas check (supervisor koperasi)\n     */\n    isPengawas: (state) => {\n      const role = state.user?.role\n      return role === 'Pengawas' // Case-sensitive sesuai backend\n    },\n\n    /**\n     * ✅ Anggota check (member koperasi)\n     */\n    isAnggota: (state) => {\n      const role = state.user?.role\n      return role === 'Anggota' // Case-sensitive sesuai backend\n    },\n\n    /**\n     * ✅ isAdmin = Pengurus OR Pengawas\n     * (kedua role ini bisa akses admin dashboard)\n     */\n    isAdmin: (state) => {\n      const role = state.user?.role\n      return role === 'Pengurus' || role === 'Pengawas'\n    },\n  },\n\n  actions: {\n    /**\n     * Login\n     */\n    async login(credentials: LoginCredentials): Promise<{ success: boolean; message: string }> {\n      this.loading = true\n      const config = useRuntimeConfig()\n\n      try {\n        if (config.public.debugMode) {\n          console.log('[AuthStore] Login start:', credentials.email)\n        }\n\n        // Call login API\n        const response = await authService.login(credentials)\n\n        if (config.public.debugMode) {\n          console.log('[AuthStore] Login response received')\n        }\n\n        // Save tokens\n        this.token = response.accessToken\n        this.refreshToken = response.refreshToken\n        this.isAuthenticated = true\n\n        // Save to localStorage\n        if (import.meta.client) {\n          localStorage.setItem('access_token', response.accessToken)\n          localStorage.setItem('refresh_token', response.refreshToken)\n        }\n\n        // ✅ Decode JWT to get user info\n        const payload = authService.decodeToken(response.accessToken)\n\n        if (payload) {\n          // ✅ FIX: Check if this is super admin login (no subdomain)\n          const isSuperAdminContext = authService.isSuperAdminContext()\n\n          if (config.public.debugMode) {\n            console.log('[AuthStore] Is Super Admin context:', isSuperAdminContext)\n            console.log('[AuthStore] JWT payload:', payload)\n          }\n\n          this.user = {\n            id: payload.sub,\n            email: payload.email,\n            // ✅ FIX: Set 'SUPERADMIN' if login from localhost without subdomain\n            role: isSuperAdminContext ? 'SUPERADMIN' : payload.role || 'ANGGOTA',\n            tenantId: payload.tenantId,\n            name: payload.email.split('@')[0], // Fallback name\n          }\n\n          // Save user to localStorage\n          if (import.meta.client) {\n            localStorage.setItem('user', JSON.stringify(this.user))\n          }\n\n          if (config.public.debugMode) {\n            console.log('[AuthStore] User profile set from JWT:', this.user)\n          }\n        }\n\n        // Handle warning (subscription expired, etc)\n        if (response.warning) {\n          console.warn('[AuthStore] Login warning:', response.warning)\n          // TODO: Show warning toast/modal\n        }\n\n        return {\n          success: true,\n          message: 'Login berhasil!',\n        }\n      } catch (error: unknown) {\n        console.error('[AuthStore] Login error:', error)\n\n        // Clear state on error\n        this.user = null\n        this.token = null\n        this.refreshToken = null\n        this.isAuthenticated = false\n\n        // Handle error message\n        let message = 'Login gagal. Silakan coba lagi.'\n\n        if (error.statusCode === 401) {\n          message = 'Email atau password salah.'\n        } else if (error.statusCode === 404) {\n          message = 'Server tidak dapat dihubungi. Pastikan backend berjalan.'\n        } else if (error.statusCode === 500) {\n          message = 'Server sedang bermasalah. Silakan coba lagi nanti.'\n        } else if (error.message) {\n          message = Array.isArray(error.message) ? error.message[0] : error.message\n        }\n\n        return {\n          success: false,\n          message,\n        }\n      } finally {\n        this.loading = false\n      }\n    },\n\n    /**\n     * Fetch user profile (optional - jika mau refresh dari backend)\n     */\n    async fetchProfile() {\n      try {\n        const profile = await authService.getProfile()\n\n        if (useRuntimeConfig().public.debugMode) {\n          console.log('[AuthStore] Profile fetched from API:', profile)\n        }\n\n        this.user = profile\n\n        // Update localStorage\n        if (import.meta.client) {\n          localStorage.setItem('user', JSON.stringify(profile))\n        }\n      } catch (error) {\n        console.error('[AuthStore] Fetch profile error:', error)\n        throw error\n      }\n    },\n\n    /**\n     * Logout\n     */\n    async logout() {\n      try {\n        await authService.logout()\n      } catch (error) {\n        console.error('[AuthStore] Logout error:', error)\n      } finally {\n        // Clear state\n        this.user = null\n        this.token = null\n        this.refreshToken = null\n        this.isAuthenticated = false\n\n        // Clear localStorage\n        if (import.meta.client) {\n          localStorage.removeItem('access_token')\n          localStorage.removeItem('refresh_token')\n          localStorage.removeItem('user')\n        }\n\n        // Redirect to login\n        navigateTo('/auth/login')\n      }\n    },\n\n    /**\n     * Initialize auth from storage (called on app start)\n     */\n    async initAuth() {\n      if (import.meta.server) return\n\n      const accessToken = localStorage.getItem('access_token')\n      const refreshToken = localStorage.getItem('refresh_token')\n      const storedUser = localStorage.getItem('user')\n\n      if (accessToken && refreshToken) {\n        try {\n          // Check if token expired\n          if (authService.isTokenExpired(accessToken)) {\n            console.log('[AuthStore] Token expired, clearing auth')\n            this.logout()\n            return\n          }\n\n          // Restore state\n          this.token = accessToken\n          this.refreshToken = refreshToken\n          this.isAuthenticated = true\n\n          // Restore user from localStorage\n          if (storedUser) {\n            this.user = JSON.parse(storedUser)\n          } else {\n            // Fallback: decode from token\n            const payload = authService.decodeToken(accessToken)\n            if (payload) {\n              // ✅ FIX: Check context to set correct role\n              const isSuperAdminContext = authService.isSuperAdminContext()\n\n              this.user = {\n                id: payload.sub,\n                email: payload.email,\n                role: isSuperAdminContext ? 'SUPERADMIN' : payload.role || 'ANGGOTA',\n                tenantId: payload.tenantId,\n                name: payload.email.split('@')[0],\n              }\n            }\n          }\n\n          if (useRuntimeConfig().public.debugMode) {\n            console.log('[AuthStore] Auth restored from storage:', {\n              user: this.user,\n              authenticated: this.isAuthenticated,\n            })\n          }\n        } catch (error) {\n          console.error('[AuthStore] Failed to restore auth:', error)\n\n          // Clear invalid data\n          localStorage.removeItem('access_token')\n          localStorage.removeItem('refresh_token')\n          localStorage.removeItem('user')\n          this.isAuthenticated = false\n        }\n      }\n    },\n  },\n})\n"],"version":3}